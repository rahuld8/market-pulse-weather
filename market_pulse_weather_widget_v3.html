<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Weather Dashboard – India (V3)</title>
<style>
:root{
  --bg:#0b1120;
  --card:#111827ee;        /* opaque for readability */
  --card-sub:#0f172aff;    /* darker subcards */
  --b:#1f2937;
  --text:#f8fafc;
  --muted:#9ca3af;
  --accent:#60a5fa;
  --good:#34d399; --warn:#f59e0b; --bad:#ef4444;
}
*{box-sizing:border-box} html,body{height:100%}
body{
  margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);background:var(--bg);overflow:hidden;
}
/* Subtle animated background */
.bg-wrap{position:fixed;inset:0;z-index:0;background:radial-gradient(1200px 800px at 10% -10%, #33415566, transparent),
linear-gradient(180deg,#0b1120,#0b132a 60%,#0b1120)}
canvas.layer{position:absolute;inset:0;width:100%;height:100%}

/* App wrapper */
.app{position:relative;z-index:10;height:100%;display:flex;align-items:center;justify-content:center;padding:20px}
.wrap{width:min(1250px,96vw);height:min(92vh,820px);display:grid;grid-template-rows:auto 1fr auto;gap:12px}
.header{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.brand{display:flex;flex-direction:column}
.brand h1{margin:0;font-size:28px;letter-spacing:.2px}
.brand .sub{color:var(--muted);font-size:13px}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.controls input,.controls select{
  background:#0b1220;border:1px solid var(--b);color:var(--text);
  padding:10px 12px;border-radius:10px;min-width:160px;outline:none;
}
.controls button{
  padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:#061227;
  font-weight:800;cursor:pointer;box-shadow:0 10px 24px #60a5fa44
}
.meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.badge{background:#0b1220;border:1px solid var(--b);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}
.code{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0b1220;border:1px solid var(--b);padding:2px 6px;border-radius:6px;color:#e5e7eb;font-size:12px}

/* Main grid */
.grid{display:grid;grid-template-columns:1.25fr 1fr;gap:12px;height:100%}
.card{background:var(--card);border:1px solid var(--b);border-radius:16px;padding:16px;box-shadow:0 16px 40px #00000055}
.card h3{margin:0 0 8px 0;font-weight:700;color:#e5e7eb}
.muted{color:var(--muted)}

.left{display:grid;grid-template-rows:1fr auto;gap:12px}
.main{display:grid;grid-template-columns:1fr 1fr;gap:12px;height:100%}
.panel{background:var(--card-sub);border:1px solid var(--b);border-radius:14px;padding:16px}
.temp{font-size:72px;font-weight:900;line-height:1;margin:8px 0;text-shadow:0 8px 30px #000a}
.cond{font-size:18px}
.hl{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
.kpi{background:#0b1220;border:1px solid var(--b);border-radius:12px;padding:12px}
.kpi .label{font-size:12px;color:var(--muted);margin-bottom:4px}
.kpi .value{font-size:20px;font-weight:800}

.right .panel{height:100%}
.fgrid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;margin-top:8px}
.day{background:#0b1220;border:1px solid var(--b);border-radius:12px;padding:10px;text-align:center;transition:transform .15s ease}
.day:hover{transform:translateY(-3px)}
.day .d{font-size:12px;color:var(--muted)}
.day .t{font-size:18px;font-weight:800;margin-top:4px}
.day .w{font-size:12px;color:var(--muted);margin-top:6px}

/* Hourly strip */
.hourly{display:grid;grid-template-columns:repeat(12,1fr);gap:8px}
.hour{background:#0b1220;border:1px solid var(--b);border-radius:10px;padding:8px;text-align:center}
.hour .h{font-size:11px;color:var(--muted)}
.hour .v{font-size:16px;font-weight:800}

/* Toggle */
.toggle{display:flex;gap:6px;align-items:center}
.switch{position:relative;width:54px;height:28px;background:#0b1220;border:1px solid var(--b);border-radius:999px;cursor:pointer}
.knob{position:absolute;top:3px;left:3px;width:22px;height:22px;background:#e5e7eb;border-radius:50%;transition:left .2s ease}
.switch.on .knob{left:29px}
.toggle span{font-size:12px;color:var(--muted)}

.footer{display:flex;align-items:center;justify-content:space-between;color:#94a3b8;font-size:12px}
@media (max-width:1100px){
  .grid{grid-template-columns:1fr}
  .main{grid-template-columns:1fr}
  .fgrid{grid-template-columns:repeat(4,1fr)}
  .hourly{grid-template-columns:repeat(6,1fr)}
}
</style>
</head>
<body>
  <!-- background canvas -->
  <div class="bg-wrap">
    <canvas class="layer" id="bg-clouds"></canvas>
    <canvas class="layer" id="bg-rain"></canvas>
  </div>

  <div class="app">
    <div class="wrap">
      <div class="header">
        <div class="brand">
          <h1>Skysense • India</h1>
          <div class="sub">Live forecast from Open‑Meteo + Nominatim (OSM)</div>
        </div>
        <div class="controls">
          <input id="state" placeholder="State (e.g., Maharashtra)" />
          <input id="district" placeholder="District (e.g., Nashik)" />
          <input id="city" placeholder="City (e.g., Pune or Lasalgaon)" />
          <div class="toggle" title="Toggle °C / °F">
            <span>°C</span>
            <div id="sw" class="switch"><div class="knob"></div></div>
            <span>°F</span>
          </div>
          <button id="go">Get forecast</button>
        </div>
      </div>

      <div class="meta" id="meta" style="display:none">
        <span class="badge" id="locLbl">—</span>
        <span class="badge">Lat/Lon: <span class="code" id="latlon">—</span></span>
        <span class="badge">TZ: <span class="code" id="tz">—</span></span>
        <span class="badge" id="asof">—</span>
      </div>

      <div class="grid">
        <div class="left">
          <div class="main">
            <div class="panel">
              <div class="cond" id="cond">—</div>
              <div class="temp" id="temp">--°</div>
              <div class="muted" id="desc">—</div>
              <div class="hl">
                <div class="kpi"><div class="label">Wind (km/h)</div><div class="value" id="wind">—</div></div>
                <div class="kpi"><div class="label">Precip (mm)</div><div class="value" id="precip">—</div></div>
                <div class="kpi"><div class="label">Sunrise / Sunset</div><div class="value" id="sun">—</div></div>
              </div>
            </div>
            <div class="panel">
              <h3>Next 12 hours</h3>
              <div class="hourly" id="hourly"></div>
            </div>
          </div>
          <div class="panel">
            <div class="muted">Data sources: <span class="code">Open‑Meteo</span> • <span class="code">Nominatim (OSM)</span></div>
          </div>
        </div>

        <div class="right card">
          <h3>Next 7 days</h3>
          <div class="fgrid" id="forecast"></div>
        </div>
      </div>

      <div class="footer">
        <div>© Skysense demo • Free & open-source</div>
        <div id="msg"></div>
      </div>
    </div>
  </div>

<script>
/* utils */
const $=id=>document.getElementById(id);
const weekday=s=>new Date(s).toLocaleDateString('en-IN',{weekday:'short'});
const hm=s=>new Date(s).toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'});

/* unit toggle */
let useF=false;
$('sw').addEventListener('click',()=>{ useF=!useF; $('sw').classList.toggle('on'); if(window.__last__){ fillUI(window.__last__.loc, window.__last__.wx); } });
function fmtTemp(c){ return Math.round(useF ? (c*9/5+32) : c) + '°'; }

/* geocode + forecast */
async function geocode(city,district,state){
  const q=[city,district,state,'India'].filter(Boolean).join(', ');
  const url=`https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=1&q=${encodeURIComponent(q)}`;
  const r=await fetch(url,{headers:{'Accept-Language':'en'}}); if(!r.ok) throw new Error('Geocoding failed');
  const j=await r.json(); if(!j.length) throw new Error('Location not found');
  return {lat:+j[0].lat, lon:+j[0].lon, display:j[0].display_name};
}
async function getForecast(lat,lon){
  const base='https://api.open-meteo.com/v1/forecast';
  const sp=new URLSearchParams({
    latitude:lat, longitude:lon, timezone:'Asia/Kolkata',
    current_weather:'true',
    hourly:'temperature_2m,precipitation_probability',
    daily:'temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max,windspeed_10m_max,weathercode,sunrise,sunset,uv_index_max',
    forecast_days:'7'
  });
  const r=await fetch(`${base}?${sp.toString()}`); if(!r.ok) throw new Error('Weather fetch failed');
  return r.json();
}

/* background animation */
const cClouds=$('bg-clouds'), cRain=$('bg-rain'); const gC=cClouds.getContext('2d'), gR=cRain.getContext('2d');
function resize(){ for(const c of [cClouds,cRain]){ c.width=innerWidth; c.height=innerHeight; } }
resize(); addEventListener('resize',resize);
let cloudPuffs=Array.from({length:36}).map(()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight*0.7,r:120+Math.random()*240,v:0.12+Math.random()*0.28,a:0.04+Math.random()*0.08}));
let rain=Array.from({length:280}).map(()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,l:8+Math.random()*16,v:4+Math.random()*6}));
let bgState='clear';
function drawClouds(){ gC.clearRect(0,0,cClouds.width,cClouds.height);
  for(const p of cloudPuffs){ const gr=gC.createRadialGradient(p.x,p.y,p.r*0.2,p.x,p.y,p.r);
    gr.addColorStop(0,'rgba(255,255,255,'+p.a+')'); gr.addColorStop(1,'rgba(255,255,255,0)');
    gC.fillStyle=gr; gC.beginPath(); gC.arc(p.x,p.y,p.r,0,Math.PI*2); gC.fill(); p.x+=p.v; if(p.x-p.r>cClouds.width) p.x=-p.r; } }
function drawRain(){ gR.clearRect(0,0,cRain.width,cRain.height); if(bgState!=='rain' && bgState!=='storm') return;
  gR.strokeStyle='rgba(160,190,255,0.7)'; gR.lineWidth=1; gR.beginPath();
  for(const d of rain){ gR.moveTo(d.x,d.y); gR.lineTo(d.x-3,d.y+d.l); d.x-=1.2; d.y+=d.v; if(d.y>cRain.height||d.x<0){ d.x=Math.random()*cRain.width; d.y=-20; } } gR.stroke(); }
function loop(){ drawClouds(); drawRain(); requestAnimationFrame(loop); } loop();

function setBG(state){
  bgState=state;
  const bg=document.querySelector('.bg-wrap');
  if(state==='clear')   bg.style.background='radial-gradient(1200px 800px at 10% -10%, #33415566, transparent), linear-gradient(180deg,#0b1120,#0e1730 60%,#0b1120)';
  if(state==='clouds')  bg.style.background='radial-gradient(1200px 800px at 10% -10%, #64748b88, transparent), linear-gradient(180deg,#0b1120,#131a33 60%,#0b1120)';
  if(state==='rain')    bg.style.background='radial-gradient(1200px 800px at 10% -10%, #1f3a5f88, transparent), linear-gradient(180deg,#0b1120,#0b1220 60%,#0b1120)';
  if(state==='storm')   bg.style.background='radial-gradient(1200px 800px at 10% -10%, #0f172a, transparent), linear-gradient(180deg,#020617,#0b1120 60%,#020617)';
  if(state==='snow')    bg.style.background='radial-gradient(1200px 800px at 10% -10%, #93c5fd66, transparent), linear-gradient(180deg,#0b1120,#12203a 60%,#0b1120)';
  // fog uses clouds base
}

/* mapping */
const WMO = {
  0:{name:'Clear sky', bg:'clear'},
  1:{name:'Mainly clear', bg:'clear'},
  2:{name:'Partly cloudy', bg:'clouds'},
  3:{name:'Overcast', bg:'clouds'},
  45:{name:'Fog', bg:'clouds'},
  48:{name:'Rime fog', bg:'clouds'},
  51:{name:'Drizzle: light', bg:'rain'},
  53:{name:'Drizzle: moderate', bg:'rain'},
  55:{name:'Drizzle: dense', bg:'rain'},
  61:{name:'Rain: slight', bg:'rain'},
  63:{name:'Rain: moderate', bg:'rain'},
  65:{name:'Rain: heavy', bg:'rain'},
  66:{name:'Freezing rain: light', bg:'storm'},
  67:{name:'Freezing rain: heavy', bg:'storm'},
  71:{name:'Snow fall: slight', bg:'snow'},
  73:{name:'Snow fall: moderate', bg:'snow'},
  75:{name:'Snow fall: heavy', bg:'snow'},
  77:{name:'Snow grains', bg:'snow'},
  80:{name:'Rain showers: slight', bg:'rain'},
  81:{name:'Rain showers: moderate', bg:'rain'},
  82:{name:'Rain showers: violent', bg:'storm'},
  85:{name:'Snow showers: slight', bg:'snow'},
  86:{name:'Snow showers: heavy', bg:'snow'},
  95:{name:'Thunderstorm', bg:'storm'},
  96:{name:'Thunderstorm (hail)', bg:'storm'},
  99:{name:'Thunderstorm (heavy hail)', bg:'storm'}
};

/* UI fill */
function fillUI(loc,wx){
  window.__last__ = {loc, wx};
  $('meta').style.display='flex';
  $('locLbl').textContent = [loc.display.split(',')[0], loc.display.split(',').slice(-2).join(', ')].join(' • ');
  $('latlon').textContent = `${wx.latitude.toFixed(3)}, ${wx.longitude.toFixed(3)}`;
  $('tz').textContent = wx.timezone;
  $('asof').textContent = 'As of ' + new Date().toLocaleString('en-IN');

  const cw = wx.current_weather || {};
  const code = cw.weathercode ?? (wx.daily?.weathercode?.[0] ?? 2);
  const meta = WMO[code] || {name:'—', bg:'clouds'};

  $('cond').textContent = meta.name;
  $('temp').textContent = (cw.temperature!=null ? fmtTemp(cw.temperature) : '--');
  $('desc').textContent = `Wind ${cw.windspeed ?? '—'} km/h`;

  const d = wx.daily;
  if(d){
    $('wind').textContent   = d.windspeed_10m_max?.[0] ?? '—';
    $('precip').textContent = d.precipitation_sum?.[0] ?? '—';
    $('sun').textContent    = (d.sunrise?.[0] && d.sunset?.[0]) ? `${hm(d.sunrise[0])} / ${hm(d.sunset[0])}` : '—';
  }

  // hourly next 12
  const hWrap = $('hourly'); hWrap.innerHTML='';
  if(wx.hourly && wx.hourly.time){
    const startIndex = wx.hourly.time.findIndex(t => new Date(t) >= new Date());
    for(let i=0;i<12;i++){
      const idx = Math.min(startIndex+i, wx.hourly.time.length-1);
      const div = document.createElement('div'); div.className='hour';
      div.innerHTML = `<div class="h">${hm(wx.hourly.time[idx])}</div>
                       <div class="v">${fmtTemp(wx.hourly.temperature_2m[idx])}</div>`;
      hWrap.appendChild(div);
    }
  }

  // 7-day
  const fc = $('forecast'); fc.innerHTML='';
  if(wx.daily && wx.daily.time){
    for(let i=0;i<Math.min(7, wx.daily.time.length); i++){
      const meta2 = WMO[wx.daily.weathercode[i]] || {name:'—'};
      const div = document.createElement('div'); div.className='day';
      div.innerHTML = `<div class="d">${weekday(wx.daily.time[i])}</div>
                       <div class="t">${fmtTemp(wx.daily.temperature_2m_max[i])} / ${fmtTemp(wx.daily.temperature_2m_min[i])}</div>
                       <div class="w">${meta2.name}</div>`;
      fc.appendChild(div);
    }
  }

  setBG(meta.bg);
}

async function run(){
  const state = $('state').value.trim() || 'Maharashtra';
  const district = $('district').value.trim();
  const city = $('city').value.trim() || 'Pune';
  try{
    $('go').disabled = true; $('go').textContent = 'Loading…';
    const loc = await geocode(city,district,state);
    const wx = await getForecast(loc.lat, loc.lon);
    loc.display = [city, district, state].filter(Boolean).join(', ');
    fillUI(loc, wx);
    $('msg').textContent = '';
  }catch(e){
    $('msg').textContent = e.message || 'Something went wrong';
    alert(e.message || 'Something went wrong');
  }finally{
    $('go').disabled = false; $('go').textContent = 'Get forecast';
  }
}
$('go').addEventListener('click', run);
run();
</script>
</body>
</html>
